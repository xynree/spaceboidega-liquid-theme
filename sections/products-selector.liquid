{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-product-variant-picker.css' | asset_url | stylesheet_tag }}
{{ 'component-swatch.css' | asset_url | stylesheet_tag }}
{{ 'component-swatch-input.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  .product-selector__buttons {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 2rem;
    justify-content: center;
  }

  .product-selector__button {
    padding: 0.5rem 1rem;
    border: 2px solid var(--color-foreground-20);
    background: transparent;
    color: var(--color-foreground);
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
  }

  .product-selector__button:hover,
  .product-selector__button.active {
    background: var(--color-foreground);
    color: var(--color-background);
    border-color: var(--color-foreground);
  }

  .product-selector__selected-product {
    margin-top: 2rem;
  }

  .product-selector__product-info {
    display: grid;
    gap: 2rem;
    grid-template-columns: 1fr;
  }

  @media screen and (min-width: 750px) {
    .product-selector__product-info {
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
    }
  }

  .product-selector__product-details h3 {
    margin-bottom: 1rem;
    font-size: 1.5rem;
  }

  .product-selector__product-description {
    margin-bottom: 1.5rem;
    line-height: 1.6;
  }
{%- endstyle -%}

<script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>

{%- liquid
  assign selected_product_index = section.settings.default_selected_product | minus: 1
  if selected_product_index < 0 or selected_product_index >= section.blocks.size
    assign selected_product_index = 0
  endif

  assign selected_product = section.blocks[selected_product_index].settings.product
  if selected_product == null and section.blocks.size > 0
    assign selected_product = section.blocks[0].settings.product
  endif
  assign product_form_id = 'product-form-' | append: section.id
-%}

<div class="color-{{ section.settings.color_scheme }} isolate gradient section-{{ section.id }}-padding">
  <div class="page-width">
    {%- if section.settings.heading != blank -%}
      <div class="title-wrapper title-wrapper--no-top-margin{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
        <h2 class="title inline-richtext {{ section.settings.heading_size }}">{{ section.settings.heading }}</h2>
      </div>
    {%- endif -%}

    {%- if section.blocks.size > 1 -%}
      <div class="product-selector__buttons">
        {%- for block in section.blocks -%}
          {%- assign product = block.settings.product -%}
          {%- if product != null -%}
            <button
              type="button"
              class="product-selector__button{% if forloop.index0 == selected_product_index %} active{% endif %}"
              data-product-index="{{ forloop.index0 }}"
              onclick="selectProduct(this, '{{ forloop.index0 }}')">
              {{ product.title }}
            </button>
          {%- endif -%}
        {%- endfor -%}
      </div>
    {%- endif -%}

    {%- if selected_product != null -%}
      <div class="product-selector__selected-product">
        <div class="product-selector__product-info">
          <div class="product-selector__product-media">
            {%- if selected_product.featured_media -%}
              <div class="product-media-container">
                {{
                  selected_product.featured_media | image_url: width: 800 | image_tag: loading: "lazy", alt: selected_product.featured_media.alt
                }}
              </div>
            {%- else -%}
              {{ 'product-apparel-1' | placeholder_svg_tag: 'placeholder-svg' }}
            {%- endif -%}
          </div>

          <div class="product-selector__product-details">
            <h3>{{ selected_product.title }}</h3>

            {%- if selected_product.description != blank -%}
              <div class="product-selector__product-description rte">
                {{ selected_product.description }}
              </div>
            {%- endif -%}

            <div class="product-selector__product-price">
              {%- render 'price'
                , product: selected_product -%}
            </div>

            {%- form 'product'
              , selected_product
              , id: product_form_id
              , class: 'form'
              , novalidate: 'novalidate'
              , data-type: 'add-to-cart-form' -%}
              <input
                type="hidden"
                name="id"
                value="{{ selected_product.selected_or_first_available_variant.id }}"
                disabled>

              {%- unless selected_product.has_only_default_variant -%}
                <variant-radios
                  data-section="{{ section.id }}"
                  data-url="{{ selected_product.url }}"
                  data-update-url="false">
                  {%- for variant in selected_product.variants -%}
                    <input
                      type="radio"
                      id="{{ section.id }}-{{ variant.id }}"
                      name="id"
                      value="{{ variant.id }}"
                      form="{{ product_form_id }}"
                      {% if variant == selected_product.selected_or_first_available_variant %}
                      checked{% endif %}>
                  {%- endfor -%}
                </variant-radios>
              {%- endunless -%}

              <div class="product-form__buttons">
                <button
                  type="submit"
                  name="add"
                  class="product-form__submit button button--primary"
                  {% if selected_product.selected_or_first_available_variant.available == false %}
                  disabled{% endif %}>
                  <span>
                    {%- if selected_product.selected_or_first_available_variant.available -%}
                      {{ 'products.product.add_to_cart' | t }}
                    {%- else -%}
                      {{ 'products.product.sold_out' | t }}
                    {%- endif -%}
                  </span>
                </button>
              </div>
            {%- endform -%}
          </div>
        </div>
      </div>
    {%- endif -%}
  </div>
</div>

<script>
  function selectProduct(button, productIndex) {
    // Remove active class from all buttons
    const buttons = button.parentNode.querySelectorAll('.product-selector__button');
    buttons.forEach(btn => btn.classList.remove('active'));
    
    // Add active class to clicked button
    button.classList.add('active');
    
    // Here you would typically make an AJAX call to load the selected product's details
    // For now, this just updates the UI
    console.log('Selected product index:', productIndex);
  }
</script>

{% schema %}
  {
    "name": "Product Selector",
    "tag": "section",
    "class": "section",
    "settings": [
      {
        "type": "inline_richtext",
        "id": "heading",
        "default": "Choose Your Product",
        "label": "Heading"
      },
      {
        "type": "select",
        "id": "heading_size",
        "options": [
          {
            "value": "h2",
            "label": "t:sections.all.heading_size.options__1.label"
          },
          {
            "value": "h1",
            "label": "t:sections.all.heading_size.options__2.label"
          },
          {
            "value": "h0",
            "label": "t:sections.all.heading_size.options__3.label"
          },
          {
            "value": "hxl",
            "label": "t:sections.all.heading_size.options__4.label"
          }, {
            "value": "hxxl",
            "label": "t:sections.all.heading_size.options__5.label"
          }
        ],
        "default": "h1",
        "label": "t:sections.all.heading_size.label"
      },
      {
        "type": "range",
        "id": "default_selected_product",
        "min": 1,
        "max": 10,
        "step": 1,
        "unit": "",
        "label": "Default selected product",
        "default": 1,
        "info": "Which product should be selected by default (1 = first product, 2 = second product, etc.)"
      },
      {
        "type": "color_scheme",
        "id": "color_scheme",
        "label": "t:sections.all.colors.label",
        "default": "scheme-1"
      }, {
        "type": "header",
        "content": "t:sections.all.padding.section_padding_heading"
      }, {
        "type": "range",
        "id": "padding_top",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "t:sections.all.padding.padding_top",
        "default": 36
      }, {
        "type": "range",
        "id": "padding_bottom",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "t:sections.all.padding.padding_bottom",
        "default": 36
      }
    ],
    "blocks": [
      {
        "type": "product",
        "name": "Product",
        "settings": [
          {
            "type": "product",
            "id": "product",
            "label": "Product"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Product Selector",
        "blocks": [
          {
            "type": "product"
          }, {
            "type": "product"
          }, {
            "type": "product"
          }
        ]
      }
    ]
  }
{% endschema %}