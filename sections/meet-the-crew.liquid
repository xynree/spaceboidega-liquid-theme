{%- style -%}
  .section-{{ section.id }} {
    display: flex;
    flex-direction: column;
    gap: 3rem;
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
  }

  .top-subtitle,
  .top-title {
    width: 100%;
    margin: auto;
    text-align: center;
  }

  .character-display {
    display: flex;
    flex-direction: column;
    gap: 4rem;
    min-height: 700px;
  }


  .character-feature {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    padding: 2rem;
    width: 400px;
    transition: opacity 0.3s ease;
  }

  .character-feature.updating {
    opacity: 0.4;
  }

  .character-feature__name {
    text-align: center;
  }

  .character-feature__image {
    max-width: 300px;
    height: auto;
    border-radius: 8px;
    object-fit: cover;
  }

  .character-feature__description {
    font-size: 13px;
    line-height: 1.45;
  }

  .feature-grid {
    display: grid;
    width: calc(100% - 480px);
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }

  .feature-grid-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    border-radius: 48px;
    border: 1px solid lightgray;
    width: 100%;
    height: 100%;
    cursor: pointer;
    font-weight: 600;
  }

  .feature-grid-item:hover {
    transform: scale(1.01);
    transition: transform .2s ease;
  }


  /** Mobile **/
  @media only screen and (max-width: 749px) {
    .section-{{ section.id }} {
      overflow-x: hidden; /* Clip the overflowing grid */
    }

    .feature-grid {
      width: 100%; /* Use full width on mobile */
      gap: 0.5rem; /* Slightly smaller gap on mobile */
      overflow-x: scroll;
      padding: 0.5rem;

    }

    .feature-grid-item {
      max-width: 100%;
    }

    .feature-grid-item.active {
      border-color: #000; /* Or your theme color */
      background-color: rgba(0, 0, 0, 0.05); /* Light background to show selection */
    }

    .character-feature {
      width: 100%;
      padding-top: 0;
    }
  }

  @media only screen and (min-width: 750px) {
    .character-display {
      flex-direction: row;
      flex-wrap: nowrap;
    }
  }
{%- endstyle -%}

<div class="page-width section-{{ section.id }}">
  <div>
    {%- if section.settings.subtitle != blank -%}
      <p class="top-subtitle">{{ section.settings.subtitle }}</p>
    {%- endif -%}

    {%- if section.settings.heading != blank -%}
      <h2 class="top-title">{{ section.settings.heading }}</h2>
    {%- endif -%}
  </div>

  <!-- Character Blocks -->

  <div class="character-display">
    <!-- Feature -->
    <div class="character-area">
      {% if section.blocks.first %}
        <div class="character-feature">
          <h3 class="character-feature__name">{{ section.blocks.first.settings.name }}</h3>
          {% if section.blocks.first.settings.image != blank %}
            {{
              section.blocks.first.settings.image
              | image_url: width: 500
              | image_tag: class: 'character-feature__image', alt: section.blocks.first.settings.name
            }}
          {% endif %}
          <div class="character-feature__description">{{ section.blocks.first.settings.description }}</div>
        </div>
      {% endif %}
    </div>

    <!-- Character Grid -->
    {%- if section.blocks.length != 0 -%}
      <div class="feature-grid">
        {%- for block in section.blocks -%}
          <div
            class="feature-grid-item"
            data-name="{{ block.settings.name | escape }}"
            data-description="{{ block.settings.description | strip_html | escape }}"
            data-image="{{ block.settings.image | image_url: width: 300 }}"
          >
            {% if block.settings.image != blank %}
              <div
                class="feature-grid-item__image"
                style="animation: fadeUp 0.6s ease-out forwards;"
                {{ block.shopify_attributes }}
              >
                {{ block.settings.image | image_url: width: 160 | image_tag: alt: block.settings.alt }}
              </div>
            {% endif %}
            <p {{ block.shopify_attributes }}>{{ block.settings.name }}</p>
          </div>
        {%- endfor %}
      </div>
    {%- endif -%}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const section = document.querySelector('.section-{{ section.id }}');
    if (!section) return;

    const gridItems = section.querySelectorAll('.feature-grid-item');
    const characterArea = section.querySelector('.character-area');

    // Render character details
    const renderCharacter = (item) => {
      const name = item.dataset.name || '';
      const description = item.dataset.description || '';
      const image = item.dataset.image || '';

      if (!name || !image) return;

      // Update existing DOM instead of recreating
      const feature = characterArea.querySelector('.character-feature');
      if (!feature) return;

      const nameEl = feature.querySelector('.character-feature__name');
      const descEl = feature.querySelector('.character-feature__description');
      const imgEl = feature.querySelector('.character-feature__image');

      if (nameEl) nameEl.textContent = name;
      if (descEl) descEl.textContent = description;

      if (imgEl) {
        imgEl.setAttribute('src', image);
        imgEl.removeAttribute('srcset');
        imgEl.alt = name;
      } else if (image) {
        const newImg = document.createElement('img');
        newImg.src = image;
        newImg.alt = name;
        newImg.className = 'character-feature__image';
        feature.insertBefore(newImg, descEl?.parentElement || null);
      }

      feature.classList.add('updating');
      setTimeout(() => feature.classList.remove('updating'), 200);
    };

    // Default: show first character
    if (gridItems.length > 0) renderCharacter(gridItems[0]);

    // Update on hover (desktop) and click (mobile)
    gridItems.forEach((item) => {
      let isMobile = window.innerWidth <= 749;

      // Add click handler for mobile
      item.addEventListener('click', (e) => {
        e.preventDefault(); // Prevent any default link behavior
        renderCharacter(item);

        // Optional: Add active state styling
        // Remove active class from all items first
        gridItems.forEach((otherItem) => otherItem.classList.remove('active'));
        // Add active class to clicked item
        item.classList.add('active');
      });

      // Keep hover for desktop, but remove for mobile to prevent conflicts
      if (!isMobile) {
        item.addEventListener('mouseenter', () => renderCharacter(item));
      }

      item.addEventListener('focus', () => renderCharacter(item)); // accessibility for keyboard focus
    });

    // Handle window resize to switch between hover/click behavior
    window.addEventListener('resize', () => {
      const newIsMobile = window.innerWidth <= 749;
      if (newIsMobile !== isMobile) {
        isMobile = newIsMobile;
        // Re-initialize event listeners if needed
        location.reload(); // Simple solution - reload to reapply correct listeners
      }
    });
  });
</script>

{%- schema -%}
{
  "name": "Meet The Crew",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "inline_richtext",
      "id": "heading",
      "default": "Meet The Crew",
      "label": "Header text"
    },
    {
      "type": "inline_richtext",
      "id": "subtitle",
      "default": "All the Spaceboi Characters",
      "label": "Subheader text"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "Character",
      "name": "character",
      "settings": [
        {
          "type": "text",
          "id": "name",
          "label": "Name",
          "default": "Spaceboi"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Meet The Crew"
    }
  ]
}
{%- endschema -%}
